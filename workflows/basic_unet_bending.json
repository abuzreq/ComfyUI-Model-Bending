{"last_node_id":27,"last_link_id":12,"nodes":[{"id":1,"type":"Threshold Module (Bending)","pos":[1066.9385986328125,1075.6854248046875],"size":[327.5999755859375,58],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Threshold Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":2,"type":"Dilation Module (Bending)","pos":[1066.9385986328125,1657.6951904296875],"size":[315,58],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Dilation Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":3,"type":"Add Scalar Module (Bending)","pos":[1066.9385986328125,848.2054443359375],"size":[340.20001220703125,58],"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Add Scalar Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":4,"type":"Multiply Scalar Module (Bending)","pos":[1065.59423828125,958.3154907226562],"size":[331.9445495605469,58],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Multiply Scalar Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":5,"type":"Sobel Module (Bending)","pos":[1066.9385986328125,1776.947509765625],"size":[315,58],"flags":{},"order":4,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Sobel Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[true]},{"id":6,"type":"Add Noise Module (Bending)","pos":[1066.9385986328125,730.8353881835938],"size":[327.5999755859375,106],"flags":{},"order":5,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Add Noise Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0.5,0,"randomize"]},{"id":7,"type":"Rotate Module (Bending)","pos":[1070.9720458984375,1196.2821044921875],"size":[315,58],"flags":{},"order":6,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Rotate Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[30]},{"id":8,"type":"Erosion Module (Bending)","pos":[1066.9385986328125,1429.004638671875],"size":[315,58],"flags":{},"order":7,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null,"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Erosion Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":9,"type":"Gradient Module (Bending)","pos":[1066.9385986328125,1545.1651611328125],"size":[315,58],"flags":{},"order":8,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Gradient Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":10,"type":"Scale Module (Bending)","pos":[1066.9385986328125,1308.00537109375],"size":[315,58],"flags":{},"order":9,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Scale Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[10]},{"id":11,"type":"Rotate Module (Bending)","pos":[1079.4324951171875,582.374755859375],"size":[315,82],"flags":{},"order":10,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[10],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Rotate Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[45]},{"id":12,"type":"KSampler","pos":[2855.47412109375,699.3388671875],"size":[315,262],"flags":{},"order":21,"mode":0,"inputs":[{"name":"model","localized_name":"model","type":"MODEL","link":1},{"name":"positive","localized_name":"positive","type":"CONDITIONING","link":2},{"name":"negative","localized_name":"negative","type":"CONDITIONING","link":3},{"name":"latent_image","localized_name":"latent_image","type":"LATENT","link":4}],"outputs":[{"name":"LATENT","localized_name":"LATENT","type":"LATENT","links":[6],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"KSampler"},"widgets_values":[31056144138804,"fixed",20,7,"dpmpp_2m","karras",1]},{"id":13,"type":"EmptyLatentImage","pos":[2862.9736328125,1007.6331176757812],"size":[210,106],"flags":{"collapsed":true},"order":11,"mode":0,"inputs":[],"outputs":[{"name":"LATENT","localized_name":"LATENT","type":"LATENT","links":[4],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"EmptyLatentImage"},"widgets_values":[512,512,1]},{"id":14,"type":"PreviewImage","pos":[3586.09130859375,706.323974609375],"size":[210,246],"flags":{},"order":23,"mode":0,"inputs":[{"name":"images","localized_name":"images","type":"IMAGE","link":5}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"PreviewImage"},"widgets_values":[]},{"id":15,"type":"VAEDecode","pos":[3279.682373046875,715.736083984375],"size":[210,46],"flags":{},"order":22,"mode":0,"inputs":[{"name":"samples","localized_name":"samples","type":"LATENT","link":6},{"name":"vae","localized_name":"vae","type":"VAE","link":7}],"outputs":[{"name":"IMAGE","localized_name":"IMAGE","type":"IMAGE","links":[5],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"VAEDecode"},"widgets_values":[]},{"id":16,"type":"Custom Code Module","pos":[960.5928955078125,67.93566131591797],"size":[556.3636474609375,389.0909423828125],"flags":{},"order":12,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0},{"name":"DEBUG","localized_name":"DEBUG","type":"STRING","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Custom Code Module","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":["import torch\nimport torch.nn as nn\n\nclass AddNoiseModule(nn.Module):\n    def __init__(self, dtype=torch.float32, device='cuda', noise_std=1):\n        super().__init__()\n        self.noise_std = noise_std\n      \n    def forward(self, image):\n        \n        \n        batch, _, height, width = image.shape\n        noise = image.new_empty(batch, 1, height, width).normal_(std=self.noise_std)\n        \n        return image + noise\n\n\noutputs[0] = AddNoiseModule()","./res/hello.py",false,false]},{"id":17,"type":"CLIPTextEncode","pos":[2430.078369140625,717.1661987304688],"size":[240.80804443359375,96.6292953491211],"flags":{},"order":18,"mode":0,"inputs":[{"name":"clip","localized_name":"clip","type":"CLIP","link":8}],"outputs":[{"name":"CONDITIONING","localized_name":"CONDITIONING","type":"CONDITIONING","links":[2],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"CLIPTextEncode"},"widgets_values":["Analog style portrait of a person"]},{"id":18,"type":"CLIPTextEncode","pos":[2429.8759765625,882.8453369140625],"size":[236.38967895507812,105.81221008300781],"flags":{},"order":19,"mode":0,"inputs":[{"name":"clip","localized_name":"clip","type":"CLIP","link":9}],"outputs":[{"name":"CONDITIONING","localized_name":"CONDITIONING","type":"CONDITIONING","links":[3],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"CLIPTextEncode"},"widgets_values":["text, watermark"]},{"id":20,"type":"Reroute","pos":[1703.0284423828125,593.4775390625],"size":[75,26],"flags":{},"order":17,"mode":0,"inputs":[{"name":"","type":"*","link":10}],"outputs":[{"name":"","type":"BENDING_MODULE","links":[12]}],"title":"Bending Module","properties":{"showOutputText":false,"horizontal":false}},{"id":22,"type":"CheckpointLoaderSimple","pos":[1518.3316650390625,791.81591796875],"size":[315,98],"flags":{},"order":13,"mode":0,"inputs":[],"outputs":[{"name":"MODEL","localized_name":"MODEL","type":"MODEL","links":[11],"slot_index":0},{"name":"CLIP","localized_name":"CLIP","type":"CLIP","links":[8,9],"slot_index":1},{"name":"VAE","localized_name":"VAE","type":"VAE","links":[7],"slot_index":2}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"CheckpointLoaderSimple"},"widgets_values":["sd-v1-4.ckpt"]},{"id":23,"type":"Model Bending (SD Layers)","pos":[2413.15087890625,550.52490234375],"size":[315,102],"flags":{},"order":20,"mode":0,"inputs":[{"name":"model","localized_name":"model","type":"MODEL","link":11},{"name":"bending_module","localized_name":"bending_module","type":"BENDING_MODULE","link":12}],"outputs":[{"name":"MODEL","localized_name":"MODEL","type":"MODEL","links":[1]}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"6622a6b3eb24f7d344673fc93762efa713a1f0ad","Node name for S&R":"Model Bending (SD Layers)"},"widgets_values":["middle_block",2]},{"id":25,"type":"Note","pos":[992.46875,-100.15774536132812],"size":[461.2020263671875,88],"flags":{},"order":14,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Users can provide custom bending modules in the shape of Pytorch nn.Module class instances"],"color":"#432","bgcolor":"#653"},{"id":26,"type":"Note","pos":[2320.752197265625,394.3101806640625],"size":[461.2020263671875,88],"flags":{},"order":15,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["(1) A user-provided bending module would be inserted into the model at the specified layer path. This insures that all calls to the UNet model will apply the bending operations."],"color":"#432","bgcolor":"#653"},{"id":27,"type":"Note","pos":[1884.96044921875,548.9552001953125],"size":[466.5312194824219,117.31058502197266],"flags":{},"order":16,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":[" The path at which the module will be inserted can be entered manually or selected interactively through the Model Inspector. Alternativly, use the Model Bending (SD Layers) node, which comes with predefined layers\n\nExample of the manual process: copy this into the path input:\nmiddle_block.2.out_layers"],"color":"#432","bgcolor":"#653"}],"links":[[1,23,0,12,0,"MODEL"],[2,17,0,12,1,"CONDITIONING"],[3,18,0,12,2,"CONDITIONING"],[4,13,0,12,3,"LATENT"],[5,15,0,14,0,"IMAGE"],[6,12,0,15,0,"LATENT"],[7,22,2,15,1,"VAE"],[8,22,1,17,0,"CLIP"],[9,22,1,18,0,"CLIP"],[10,11,0,20,0,"*"],[11,22,0,23,0,"MODEL"],[12,20,0,23,1,"BENDING_MODULE"]],"groups":[{"id":1,"title":"Supported Bending Operations","bounding":[993.3460693359375,493.6164855957031,460,1390],"color":"#3f789e","font_size":24,"flags":{}},{"id":2,"title":"Group","bounding":[950.5928955078125,-182.92388916015625,576.3636474609375,649.9495849609375],"color":"#3f789e","font_size":24,"flags":{}},{"id":3,"title":"Group","bounding":[940.5928955078125,-226.52386474609375,2865.49853515625,2120.140380859375],"color":"#3f789e","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":1.1258730373018866,"offset":[-1657.58142279274,83.44292614121761]}},"version":0.4}