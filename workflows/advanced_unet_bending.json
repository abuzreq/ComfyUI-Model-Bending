{"last_node_id":31,"last_link_id":15,"nodes":[{"id":1,"type":"Threshold Module (Bending)","pos":[82.47026824951172,547.3995971679688],"size":[327.5999755859375,58],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Threshold Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":2,"type":"Dilation Module (Bending)","pos":[82.47026824951172,1129.4093017578125],"size":[315,58],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Dilation Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":3,"type":"Add Scalar Module (Bending)","pos":[82.47026824951172,319.9195861816406],"size":[340.20001220703125,58],"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Add Scalar Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":4,"type":"Multiply Scalar Module (Bending)","pos":[81.12584686279297,430.0296325683594],"size":[331.9445495605469,58],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Multiply Scalar Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":5,"type":"Sobel Module (Bending)","pos":[82.47026824951172,1248.66162109375],"size":[315,58],"flags":{},"order":4,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Sobel Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[true]},{"id":7,"type":"Add Noise Module (Bending)","pos":[82.47026824951172,202.54949951171875],"size":[327.5999755859375,106],"flags":{},"order":5,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Add Noise Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0.5,0,"randomize"]},{"id":8,"type":"Rotate Module (Bending)","pos":[86.50365447998047,667.9962768554688],"size":[315,58],"flags":{},"order":6,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Rotate Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[30]},{"id":9,"type":"Erosion Module (Bending)","pos":[82.47026824951172,900.7188110351562],"size":[315,58],"flags":{},"order":7,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":null,"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Erosion Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":10,"type":"Gradient Module (Bending)","pos":[82.47026824951172,1016.8792724609375],"size":[315,58],"flags":{},"order":8,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Gradient Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[0]},{"id":11,"type":"Scale Module (Bending)","pos":[82.47026824951172,779.7195434570312],"size":[315,58],"flags":{},"order":9,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Scale Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[10]},{"id":12,"type":"Rotate Module (Bending)","pos":[94.96410369873047,54.08885955810547],"size":[315,82],"flags":{},"order":10,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[1],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Rotate Module (Bending)","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[45]},{"id":17,"type":"KSampler","pos":[1871.0057373046875,171.05300903320312],"size":[315,262],"flags":{},"order":22,"mode":0,"inputs":[{"name":"model","localized_name":"model","type":"MODEL","link":4},{"name":"positive","localized_name":"positive","type":"CONDITIONING","link":5},{"name":"negative","localized_name":"negative","type":"CONDITIONING","link":6},{"name":"latent_image","localized_name":"latent_image","type":"LATENT","link":7}],"outputs":[{"name":"LATENT","localized_name":"LATENT","type":"LATENT","links":[8],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"KSampler"},"widgets_values":[31056144138804,"fixed",20,7,"dpmpp_2m","karras",1]},{"id":18,"type":"EmptyLatentImage","pos":[1878.50537109375,479.34722900390625],"size":[210,106],"flags":{"collapsed":true},"order":11,"mode":0,"inputs":[],"outputs":[{"name":"LATENT","localized_name":"LATENT","type":"LATENT","links":[7],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"EmptyLatentImage"},"widgets_values":[512,512,1]},{"id":20,"type":"PreviewImage","pos":[2601.623046875,178.03811645507812],"size":[210,246],"flags":{},"order":24,"mode":0,"inputs":[{"name":"images","localized_name":"images","type":"IMAGE","link":9}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"PreviewImage"},"widgets_values":[]},{"id":19,"type":"VAEDecode","pos":[2295.214111328125,187.45021057128906],"size":[210,46],"flags":{},"order":23,"mode":0,"inputs":[{"name":"samples","localized_name":"samples","type":"LATENT","link":8},{"name":"vae","localized_name":"vae","type":"VAE","link":11}],"outputs":[{"name":"IMAGE","localized_name":"IMAGE","type":"IMAGE","links":[9],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"VAEDecode"},"widgets_values":[]},{"id":26,"type":"Custom Code Module","pos":[-23.875438690185547,-460.3502197265625],"size":[556.3636474609375,389.0909423828125],"flags":{},"order":12,"mode":0,"inputs":[],"outputs":[{"name":"BENDING_MODULE","localized_name":"BENDING_MODULE","type":"BENDING_MODULE","links":[],"slot_index":0},{"name":"DEBUG","localized_name":"DEBUG","type":"STRING","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Custom Code Module","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":["import torch\nimport torch.nn as nn\n\nclass AddNoiseModule(nn.Module):\n    def __init__(self, dtype=torch.float32, device='cuda', noise_std=1):\n        super().__init__()\n        self.noise_std = noise_std\n      \n    def forward(self, image):\n        \n        \n        batch, _, height, width = image.shape\n        noise = image.new_empty(batch, 1, height, width).normal_(std=self.noise_std)\n        \n        return image + noise\n\n\noutputs[0] = AddNoiseModule()","./res/hello.py",false,false]},{"id":21,"type":"CLIPTextEncode","pos":[1445.6099853515625,188.88031005859375],"size":[240.80804443359375,96.6292953491211],"flags":{},"order":19,"mode":0,"inputs":[{"name":"clip","localized_name":"clip","type":"CLIP","link":12}],"outputs":[{"name":"CONDITIONING","localized_name":"CONDITIONING","type":"CONDITIONING","links":[5],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"CLIPTextEncode"},"widgets_values":["Analog style portrait of a person"]},{"id":22,"type":"CLIPTextEncode","pos":[1445.4075927734375,354.5594787597656],"size":[236.38967895507812,105.81221008300781],"flags":{},"order":20,"mode":0,"inputs":[{"name":"clip","localized_name":"clip","type":"CLIP","link":13}],"outputs":[{"name":"CONDITIONING","localized_name":"CONDITIONING","type":"CONDITIONING","links":[6],"slot_index":0}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"CLIPTextEncode"},"widgets_values":["text, watermark"]},{"id":24,"type":"Model Inspector","pos":[868.3598022460938,428.4677734375],"size":[409.3170166015625,332.46905517578125],"flags":{},"order":18,"mode":0,"inputs":[{"name":"model","localized_name":"model","type":"MODEL","link":10}],"outputs":[{"name":"STRING","localized_name":"STRING","type":"STRING","links":[14],"slot_index":0},{"name":"MODEL","localized_name":"MODEL","type":"MODEL","links":null}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Model Inspector","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":[false],"bgcolor":"hsla(0, 0%, 20.8%, 1)"},{"id":16,"type":"Model Bending","pos":[1424.42919921875,22.77991485595703],"size":[315,98],"flags":{},"order":21,"mode":0,"inputs":[{"name":"model","localized_name":"model","type":"MODEL","link":15},{"name":"bending_module","localized_name":"bending_module","type":"BENDING_MODULE","link":2},{"name":"path","type":"STRING","widget":{"name":"path"},"link":14}],"outputs":[{"name":"MODEL","localized_name":"MODEL","type":"MODEL","links":[4],"slot_index":0}],"properties":{"cnr_id":"ComfyUI-Model-Bending","ver":"e60dd40e8cd85127e181764c1470f45e17060158","Node name for S&R":"Model Bending","aux_id":"abuzreq/ComfyUI-Model-Bending"},"widgets_values":["middle_block.2.out_layers"],"color":"#223","bgcolor":"#335"},{"id":6,"type":"Reroute","pos":[718.5601196289062,65.191650390625],"size":[75,26],"flags":{},"order":17,"mode":0,"inputs":[{"name":"","type":"*","link":1}],"outputs":[{"name":"","type":"BENDING_MODULE","links":[2]}],"title":"Bending Module","properties":{"showOutputText":false,"horizontal":false}},{"id":23,"type":"CheckpointLoaderSimple","pos":[533.86328125,263.530029296875],"size":[315,98],"flags":{},"order":13,"mode":0,"inputs":[],"outputs":[{"name":"MODEL","localized_name":"MODEL","type":"MODEL","links":[10,15],"slot_index":0},{"name":"CLIP","localized_name":"CLIP","type":"CLIP","links":[12,13],"slot_index":1},{"name":"VAE","localized_name":"VAE","type":"VAE","links":[11],"slot_index":2}],"properties":{"cnr_id":"comfy-core","ver":"0.3.26","Node name for S&R":"CheckpointLoaderSimple"},"widgets_values":["sd-v1-4.ckpt"]},{"id":29,"type":"Note","pos":[61.955535888671875,-617.0064086914062],"size":[381.8123474121094,100.89665985107422],"flags":{},"order":14,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Users can provide custom bending modules in the shape of Pytorch nn.Module class instances"],"color":"#432","bgcolor":"#653"},{"id":30,"type":"Note","pos":[1393.0921630859375,-147.25051879882812],"size":[381.8123474121094,100.89665985107422],"flags":{},"order":15,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["(1) A user-provided bending module would be inserted into the model at the specified layer path. This insures that all calls to the UNet model will apply the bending operations."],"color":"#432","bgcolor":"#653"},{"id":31,"type":"Note","pos":[937.4111328125,31.153226852416992],"size":[381.8123474121094,100.89665985107422],"flags":{},"order":16,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["The path at which the module will be inserted can be entered manually or selected interactively through the Model Inspector\n\nExample of the manual process: copy this into the path input:\nmiddle_block.2.out_layers"],"color":"#432","bgcolor":"#653"}],"links":[[1,12,0,6,0,"*"],[2,6,0,16,1,"BENDING_MODULE"],[4,16,0,17,0,"MODEL"],[5,21,0,17,1,"CONDITIONING"],[6,22,0,17,2,"CONDITIONING"],[7,18,0,17,3,"LATENT"],[8,17,0,19,0,"LATENT"],[9,19,0,20,0,"IMAGE"],[10,23,0,24,0,"MODEL"],[11,23,2,19,1,"VAE"],[12,23,1,21,0,"CLIP"],[13,23,1,22,0,"CLIP"],[14,24,0,16,2,"STRING"],[15,23,0,16,0,"MODEL"]],"groups":[{"id":1,"title":"Supported Bending Operations","bounding":[8.877740859985352,-34.669410705566406,460,1390],"color":"#3f789e","font_size":24,"flags":{}},{"id":2,"title":"Group","bounding":[-33.87543487548828,-711.2097778320312,576.3636474609375,649.9495849609375],"color":"#3f789e","font_size":24,"flags":{}},{"id":3,"title":"Group","bounding":[-43.87543487548828,-754.8097534179688,2865.49853515625,2120.140380859375],"color":"#3f789e","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.9304735845470123,"offset":[-479.57956624123574,716.8529621231728]}},"version":0.4}